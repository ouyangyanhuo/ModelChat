function showError(e){document.getElementById("error-container").innerHTML=`\n        <div class="error-message bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded">\n            <div class="flex items-center">\n                <i class="fas fa-exclamation-circle mr-2"></i>\n                <span>${e}</span>\n            </div>\n        </div>\n    `}async function checkFirstLogin(){try{const e=await fetch("/check_first_login");if(e.ok){(await e.json()).first_login&&document.getElementById("first-login-hint").classList.remove("hidden")}}catch(e){console.log("检查首次登录状态失败:",e)}}document.getElementById("login-form").addEventListener("submit",async function(e){e.preventDefault();const t=document.getElementById("username").value,n=document.getElementById("password").value,o=document.querySelector(".auth-button"),r=document.getElementById("login-text");r.innerHTML='<i class="fas fa-spinner fa-spin"></i> 登录中...',o.disabled=!0;try{const e=await fetch("/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:t,password:n})}),i=await e.json();e.ok?window.location.href=i.redirect:(showError(i.error),r.textContent="登录",o.disabled=!1)}catch(e){showError("网络错误，请稍后重试"),r.textContent="登录",o.disabled=!1}}),document.addEventListener("DOMContentLoaded",function(){checkFirstLogin(),"true"===localStorage.getItem("darkMode")&&document.body.classList.add("dark-mode")});